cmake_minimum_required( VERSION 2.6 )
find_package( brainvisa-cmake REQUIRED )
BRAINVISA_PROJECT()

BRAINVISA_DEPENDENCY( DEV DEPENDS "${BRAINVISA_PACKAGE_NAME}" RUN "= ${${BRAINVISA_PACKAGE_NAME}_VERSION}" )

find_package( Sigc++2 REQUIRED )
BRAINVISA_DEPENDENCY( RUN DEPENDS libsigc++ RUN )
BRAINVISA_DEPENDENCY( DEV DEPENDS libsigc++ DEV )

find_package( LibXml2 REQUIRED )
BRAINVISA_DEPENDENCY( RUN DEPENDS libxml2 RUN )
BRAINVISA_DEPENDENCY( DEV DEPENDS libxml2 DEV )

find_package( Boost REQUIRED )
BRAINVISA_DEPENDENCY( RUN DEPENDS libboost RUN )
BRAINVISA_DEPENDENCY( DEV DEPENDS libboost DEV )

find_package( Doxygen )

find_package( PythonInterp )
if( PYTHONINTERP_FOUND )
  find_package( PythonLibs )
  find_package( Numpy )
  find_package( SIP )
  if( PYTHONLIBS_FOUND AND NUMPY_FOUND AND SIP_FOUND )
    BRAINVISA_DEPENDENCY( RUN DEPENDS python RUN )
    BRAINVISA_DEPENDENCY( DEV DEPENDS python DEV )
    BRAINVISA_DEPENDENCY( DEV DEPENDS numpy DEV )
    BRAINVISA_DEPENDENCY( RUN DEPENDS numpy RUN )
    BRAINVISA_DEPENDENCY( DEV DEPENDS sip DEV )
    BRAINVISA_DEPENDENCY( DEV DEPENDS sip DEV )
  endif()
endif( PYTHONINTERP_FOUND )

find_package( JPEG )
if( JPEG_FOUND )
  BRAINVISA_DEPENDENCY( RUN DEPENDS libjpeg RUN )
endif()
BRAINVISA_DEPENDENCY( DEV RECOMMENDS libjpeg DEV )

find_package( DCMTK )
if( DCMTK_FOUND )
  BRAINVISA_DEPENDENCY( RUN DEPENDS dcmtk RUN )
endif()

find_package( MINC )
BRAINVISA_DEPENDENCY( DEV RECOMMENDS dcmtk DEV )
if( MINC_FOUND )
  BRAINVISA_DEPENDENCY( RUN DEPENDS minc RUN )
endif()
BRAINVISA_DEPENDENCY( DEV RECOMMENDS minc DEV )

find_package( TIFF )
if( TIFF_FOUND )
  BRAINVISA_DEPENDENCY( RUN DEPENDS libtiff RUN )
endif()
BRAINVISA_DEPENDENCY( DEV RECOMMENDS libtiff DEV )

find_package( EXPAT )
if( EXPAT_FOUND )
  BRAINVISA_DEPENDENCY( RUN DEPENDS libexpat RUN )
endif()
BRAINVISA_DEPENDENCY( DEV RECOMMENDS libexpat DEV )

set( AIMS_DEFINITIONS "-D_REENTRANT -DAIMS" )
if( "${CMAKE_BUILD_TYPE}" STREQUAL "Release" OR "${CMAKE_BUILD_TYPE}" STREQUAL "RelWithDebInfo" OR "${CMAKE_BUILD_TYPE}" STREQUAL "MinSizeRel" )
  set( AIMS_DEFINITIONS "${AIMS_DEFINITIONS} -DCARTO_DEBUGMODE=\"release\"" )
else( "${CMAKE_BUILD_TYPE}" STREQUAL "Release" OR "${CMAKE_BUILD_TYPE}" STREQUAL "RelWithDebInfo" OR "${CMAKE_BUILD_TYPE}" STREQUAL "MinSizeRel" )
  if( "${CMAKE_BUILD_TYPE}" STREQUAL "Debug" )
    set( AIMS_DEFINITIONS "${AIMS_DEFINITIONS} -DCARTO_DEBUGMODE=\"debug\"" )
  else( "${CMAKE_BUILD_TYPE}" STREQUAL "Debug" )
    set( AIMS_DEFINITIONS "${AIMS_DEFINITIONS} -DCARTO_DEBUGMODE=\"default\"" )
  endif( "${CMAKE_BUILD_TYPE}" STREQUAL "Debug" )
endif( "${CMAKE_BUILD_TYPE}" STREQUAL "Release" OR "${CMAKE_BUILD_TYPE}" STREQUAL "RelWithDebInfo" OR "${CMAKE_BUILD_TYPE}" STREQUAL "MinSizeRel" )
add_definitions( ${AIMS_DEFINITIONS} )

set( AIMS_INCLUDE_DIRS 
     ${Sigc++2_INCLUDE_DIRS} 
     "${LIBXML2_INCLUDE_DIR}"
     ${Boost_INCLUDE_DIRS} )
if( PYTHONLIBS_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS} 
       "${PYTHON_INCLUDE_PATH}" )
endif( PYTHONLIBS_FOUND )
if( NUMPY_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${NUMPY_INCLUDE_DIR}" )
endif( NUMPY_FOUND )
if( SIP_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${SIP_INCLUDE_DIR}" )
endif( SIP_FOUND )
if( JPEG_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${JPEG_INCLUDE_DIR}" )
endif()
if( DCMTK_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${DCMTK_INCLUDE_DIR}" )
endif()
if( MINC_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${MINC_INCLUDE_DIRS}" )
endif()
if( TIFF_FOUND )
  set( AIMS_INCLUDE_DIRS ${AIMS_INCLUDE_DIRS}
       "${TIFF_INCLUDE_DIR}" )
endif()
include_directories( ${CMAKE_BINARY_DIR}/include ${AIMS_INCLUDE_DIRS} )


add_subdirectory( cartobase )
add_subdirectory( cartodata )
add_subdirectory( graph )
add_subdirectory( ecat )
add_subdirectory( ecat+ )
if( NOT WIN32 )
  add_subdirectory( vidaIO )
endif( NOT WIN32 )
add_subdirectory( aimsdata )
add_subdirectory( aimsalgo )
if( PYTHONLIBS_FOUND AND NUMPY_FOUND AND SIP_FOUND )
  set( AIMS_RELATIVE_SIP_DIRECTORY
       "share/aims-${${PROJECT_NAME}_VERSION_MAJOR}.${${PROJECT_NAME}_VERSION_MINOR}/sip" )
  add_subdirectory( pyaims )
else( PYTHONLIBS_FOUND AND NUMPY_FOUND AND SIP_FOUND )
  message( "WARNING: Not building pyaims and pyaimsalgo due to missing dependency:\n  PYTHONLIBS_FOUND=${PYTHONLIBS_FOUND}\n  NUMPY_FOUND=${NUMPY_FOUND}\n  SIP_FOUND=${SIP_FOUND}" )
endif( PYTHONLIBS_FOUND AND NUMPY_FOUND AND SIP_FOUND )

set( AIMS_INSTALL_DIR "${CMAKE_INSTALL_PREFIX}" )
set( AIMS_BINARY_DIR "${CMAKE_BINARY_DIR}" )

BRAINVISA_CREATE_CMAKE_CONFIG_FILES()

